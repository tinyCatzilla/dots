"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PrettierDocumentFormatter = void 0;
const errorPrinter_1 = require("../../document/printers/errorPrinter");
const documentFormatter_1 = require("../documentFormatter");
const utils_1 = require("./utils");
class PrettierDocumentFormatter extends documentFormatter_1.DocumentFormatter {
    constructor(options, transformOptions) {
        super();
        (0, utils_1.setOptions)(options);
        this.withHtmlFormatter(utils_1.formatAsHtml)
            .withFilePath(options.filepath)
            .withPhpFormatter(utils_1.inlineFormatPhp)
            .withBlockPhpFormatter(utils_1.formatPhp)
            .withPhpTagFormatter(utils_1.formatTagPhp)
            .withJsonFormatter(utils_1.formatJson)
            .withTransformOptions(transformOptions)
            .withPreFormatter((document) => {
            var _a, _b, _c;
            if (document.errors.hasStructureErrors()) {
                const error = document.errors.getFirstStructureError(), lines = document.getLinesAround((_c = (_b = (_a = error.node) === null || _a === void 0 ? void 0 : _a.startPosition) === null || _b === void 0 ? void 0 : _b.line) !== null && _c !== void 0 ? _c : 1), prettyError = errorPrinter_1.ErrorPrinter.printError(error, lines);
                throw new SyntaxError(prettyError);
            }
            return null;
        });
    }
}
exports.PrettierDocumentFormatter = PrettierDocumentFormatter;
//# sourceMappingURL=prettierDocumentFormatter.js.map